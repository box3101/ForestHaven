---
import BaseLayout from "../../layouts/BaseLayout.astro";
import SubLayout from "../../layouts/SubLayout.astro";
import SubBody from "../../layouts/SubBody.astro";

const datph2 = "대관안내";
const location = "대관신청";
const pageTitle = `홈>${datph2}>${location}`;
const idName = "Notice";

import "../../css/ui.css";

//스텝 화면 구성
export interface Step {
	number: number;
	title: string;
	image: string;
	icon: string;
	isActive?: boolean;
	isCompleted?: boolean;
}

export const stepAreaData: Step[] = [
	{
		number: 1,
		title: "일정선택",
		image: "../img/icon_step-01.svg",
		icon: "../img/icon-arrow-gy.svg",
		isActive: false,
		isCompleted: false,
	},
	{
		number: 2,
		title: "정보등록",
		image: "../img/icon_step-02.svg",
		icon: "../img/icon-arrow-gy.svg",
		isActive: true,
		isCompleted: false,
	},
	{
		number: 3,
		title: "본인인증",
		image: "../img/icon_step-03.svg",
		icon: "",
		isActive: false,
		isCompleted: false,
	},
];

// 대관신청 타이틀
export interface facilityTitle {
	title: string;
	link?: string;
	infoLink?: string;
}

export const facilityTitle: facilityTitle[] = [
	{
		title: "송도솔밭 물빛누리공원",
		link: "../facilityTitle/1",
		infoLink: "../facilityTitle/1",
	},
];

// 대관신청 상세
export interface facilityDetial {
	image: string;
	facilityType: {
		boldTitle: string;
		normalText: string;
	}[];
}

export const facilityDetial: facilityDetial[] = [
	{
		image: "../img/card_img01.png",
		facilityType: [
			{
				boldTitle: "사용시설",
				normalText: "물빛누리공원",
			},
			{
				boldTitle: "관리기관",
				normalText: "포항시 공원과 공원관리팀(054-251-2564)",
			},
			{
				boldTitle: "이용구분",
				normalText: "최소 1명 / 최대 99명",
			},
			{
				boldTitle: "주소",
				normalText: "경상북도 포항시 남구 송도해안길 141 (송도동)",
			},
		],
	},
];

// 관련 시설 슬라이더
export interface RelatedFacility {
	title: string;
	image: string;
	link: string;
}

export const relatedFacilities: RelatedFacility[] = [
	{
		title: "송도 솔밭 물빛누리공원",
		image: "../img/swiper_img01.png",
		link: "../facility/1",
	},
	{
		title: "내연산 치유의 숲",
		image: "../img/swiper_img02.png",
		link: "../facility/2",
	},
	{
		title: "송도 솔밭 물빛누리공원",
		image: "../img/swiper_img03.png",
		link: "../facility/3",
	},
	{
		title: "내연산 치유의 숲",
		image: "../img/swiper_img04.png",
		link: "../facility/4",
	},
	{
		title: "추가 시설 5",
		image: "../img/swiper_img01.png",
		link: "../facility/5",
	},
	{
		title: "추가 시설 6",
		image: "../img/swiper_img02.png",
		link: "../facility/6",
	},
];

//시설안내박스
export interface FacilityInfoItem {
	boldTitle: string;
	normalText: string;
	isNotice?: boolean; // 강조 표시용
}

export interface FacilityInfo {
	facilityType: FacilityInfoItem[];
}

export const facilityInfo: FacilityInfo[] = [
	{
		facilityType: [
			{
				boldTitle: "신청기간",
				normalText:
					"사용달 전월 1일~말일까지 (예시 : 2025년 8월 16일 공연 신청 시 7월 1일 부터 신청가능)",
			},
			{
				boldTitle: "장소",
				normalText: "송도 솔밭 물빛누리공원 야외공연장",
			},
			{
				boldTitle: "이용가능시간",
				normalText: "매주 토, 일요일 (09:00~19:00)까지, 평일 이용 불가. 1일 1팀 사용가능",
			},
			{
				boldTitle: "신청방법",
				normalText:
					"선착순 접수 (※[통합] 신청서 및 계획서를 첨부파일 업로드 하여 관리부서 허가를 득한 후 사용가능)",
			},
			{
				boldTitle: "신청가능 프로그램",
				normalText: "음악, 무용, 연극, 전시, 미술 등 공연과 전시가 가능한 문화예술 전 분야",
			},
			{
				boldTitle:
					'첨부양식 중, "공영장 사용 신청서" 를 다운받아 작성 후, 첨부파일로 업로드해주세요.',
				normalText: "",
				isNotice: true,
			},
		],
	},
];

export const facilityInfo2: FacilityInfo[] = [
	{
		facilityType: [
			{
				boldTitle: "대관신청 일자",
				normalText: "2025년 9월 14일",
			},
			{
				boldTitle: "대관신청 시간",
				normalText: "13:00~14:00, 14:00~15:00, 15:00,~16:00",
			},
		],
	},
];

export const usageNotice: usageNotice[] = [
	{
		facilityType: [
			{
				boldTitle: "1. 공영장의 사용허가는 다음과 같다.",
				normalText: "가. 야외 공연장을 사용하고자 하는..",
			},
			{
				boldTitle: "",
				normalText:
					"나.시설 예약은 사용하고자 하는 달의 전월 1일~말일까지 신청하고 관리부서의 심의를 통해 허가를 득하여야 한다.",
			},
		],
	},
];

//시설물 이용에 대한 주의사항
export interface FacilityNotice {
	facilityType: {
		boldTitle: string;
		normalText: string;
	}[];
}

export const FacilityNotice: FacilityNotice[] = [
	{
		facilityType: [
			{
				boldTitle: "공연장의 사용승인은 다음과 같다.",
				normalText: "",
			},
		],
	},
	{
		facilityType: [
			{
				boldTitle: "",
				normalText: "공연장 시설 예약은 선착순으로 하며, 매달 1일~ 예약이 시작된다.",
			},
			{
				boldTitle: "",
				normalText: "공연장을 사용하고자 하는 자는...",
			},
			{
				boldTitle: "",
				normalText: "신청은 사용하고자 하는 달의 전우러 1일~31일 까지 신청하고,",
			},
			{
				boldTitle: "",
				normalText: "공연사용 신청 시, 매달 4회만 신청 가능",
			},
		],
	},
];

// 첨부양식
export interface DownloadFile {
	image: string;
	name: string;
	fileName: string;
	filePath: string;
}

export const DownloadFile: DownloadFile[] = [
	{
		image: "../img/icon_clip.svg",
		name: "[붙임1]야외공연장 사용허가 신청서.hwp",
		fileName: "[붙임1]야외공연장 사용허가 신청서.hwp",
		filePath: "../documents/[붙임1]야외공연장 사용허가 신청서.hwp",
	},
	{
		image: "../img/icon_clip.svg",
		name: "[붙임3] 안전관리 이행서약서.hwp",
		fileName: "[붙임3] 안전관리 이행서약서.hwp",
		filePath: "../documents/[붙임3] 안전관리 이행서약서.hwp",
	},
];

// 체크박스
export const checkboxData: checkbox[] = [
	{
		label: "시설물 이용에 대한 주의사항",
		value: "시설물 이용에 대한 주의사항",
	},
];
---

<BaseLayout pageTitle={pageTitle}>
	<SubLayout idName={idName} title={location} datph2={datph2}>
		<SubBody title={location}>
			<!-- 스텝아이콘 -->
			<div class="step-indicator">
				<div class="step-container">
					{
						stepAreaData.map((step, index) => (
							<>
								<div
									class={`step-item ${step.isActive ? "active" : ""} ${
										step.isCompleted ? "completed" : ""
									}`}
								>
									<div class="step-number">{step.number}</div>
									<span class="step-title">{step.title}</span>
									<img src={step.image} alt="스텝아이콘" />
								</div>
								{index < stepAreaData.length - 1 && step.icon && (
									<div class="step-arrow">
										<img
											src={step.icon}
											alt="다음 단계"
											class={step.isActive || step.isCompleted ? "active" : ""}
										/>
									</div>
								)}
							</>
						))
					}
				</div>
			</div>

			<!-- 타이틀 -->
			{
				facilityTitle.map((facility, index) => (
					<div class="facility-title">
						<h3 class="tit-bold">{facility.title}</h3>
						<div class="facility-buttons">
							{facility.infoLink && (
								<a href="./RentalApplication-step3.html" class="btn-next">
									다음으로
								</a>
							)}
							{facility.infoLink && (
								<a href="./RentalApplication-write.html" class="btn-previous">
									이전으로
								</a>
							)}
							{facility.link && (
								<a href="./RentalApplication.html" class="btn-list">
									목록으로
								</a>
							)}
						</div>
					</div>
				))
			}

			<!-- 공원 정보 -->
			<section class="facility-listWrap">
				<div class="description-Box">
					{
						facilityDetial.map((facility, index) => (
							<div class="facility-item">
								<div class="facility-image">
									<img src={facility.image} alt={facility.facilityType[0].boldTitle} />
								</div>
								<div class="facility-info">
									{facility.facilityType.map((facilityType, index) => (
										<div class="facility-info-group">
											<h2 class="boldTitle">{facilityType.boldTitle}</h2>
											<p class="normalText">{facilityType.normalText}</p>
										</div>
									))}
								</div>
							</div>
						))
					}
				</div>
			</section>

			<!-- 시설안내 -->
			<section class="facility-info-container">
				<h2 class="section-title">시설안내</h2>
				{
					facilityInfo.map((facility) => (
						<div class="facility-info-group">
							{facility.facilityType.map((facilityType) => (
								<div class={`facility-info-item ${facilityType.isNotice ? "highlight" : ""}`}>
									{facilityType.boldTitle && <h2 class="boldTitle">{facilityType.boldTitle}</h2>}
									{facilityType.normalText && <p class="normalText">{facilityType.normalText}</p>}
								</div>
							))}
						</div>
					))
				}
			</section>

			<!-- 시설물 이용에 대한 주의사항  -->
			<section class="facility-notice-container">
				<h2 class="section-title">시설물 이용에 대한 주의사항</h2>
				<div class="facility-notice-Wrap mb-20">
					{
						FacilityNotice.map((facility, facilityIndex) => (
							<>
								{facility.facilityType.map((facilityType, typeIndex) => (
									<div class="facility-info-item">
										<h2 class="boldTitle">{facilityType.boldTitle}</h2>
										<p
											class={`normalText ${
												facilityIndex === 0 && typeIndex === 0 ? "" : "icon-arrow"
											}`}
										>
											{facilityType.normalText}
										</p>
									</div>
								))}
							</>
						))
					}
				</div>
				<!-- 체크박스 추가 -->
				<div class="checkbox-container">
					{
						checkboxData.map((checkbox, index) => (
							<div class="checkbox-item">
								<input type="checkbox" id={`checkbox-${index}`} value={checkbox.value} />
								<label for={`checkbox-${index}`} class="checkbox-label">
									{checkbox.label}
								</label>
							</div>
						))
					}
				</div>
			</section>

			<!-- 대관신청 정보 -->
			<section class="facility-info-container">
				<h2 class="section-title">대관신청 정보</h2>

				{
					facilityInfo2.map((facility) => (
						<div class="facility-info-group">
							{facility.facilityType.map((facilityType) => (
								<div class="facility-info-item">
									<h2 class="boldTitle">{facilityType.boldTitle}</h2>
									<p class="normalText">{facilityType.normalText}</p>
								</div>
							))}
						</div>
					))
				}
			</section>

			<!-- 정보입력 -->
			<section class="facility-info-container">
				<h2 class="section-title">정보입력</h2>

				<!-- 정보입력 테이블 폼 -->
				<div class="notice-detail-section">
					<div class="notice-detail-table">
						<table class="detail-table">
							<caption class="hidden">대관신청 정보입력</caption>
							<colgroup>
								<col style="width: 180px;" />
								<col style="width: auto;" />
								<col style="width: 180px;" />
								<col style="width: auto;" />
							</colgroup>
							<tbody>
								<!-- 대표전화 행 -->
								<tr class="input-row">
									<th scope="row" class="label-cell">
										<label for="phone">대표전화<span class="required">*</span></label>
									</th>
									<td class="content-cell" colspan="3">
										<input
											type="tel"
											id="phone"
											name="phone"
											placeholder="01022225555"
											maxlength="11"
											class="input-field"
										/>
									</td>
								</tr>

								<!-- 예약인원 행 -->
								<tr class="input-row">
									<th scope="row" class="label-cell">
										<label for="participants">예약인원<span class="required">*</span></label>
									</th>
									<td class="content-cell" colspan="3">
										<div class="input-group">
											<input
												type="number"
												id="participants"
												name="participants"
												placeholder="12"
												min="1"
												max="99"
												class="input-field input-small"
											/>
											<span class="input-unit">명</span>
										</div>
									</td>
								</tr>

								<!-- 단체명 행 -->
								<tr class="input-row">
									<th scope="row" class="label-cell">
										<label for="facility">단체명<span class="required">*</span></label>
									</th>
									<td class="content-cell" colspan="3">
										<input
											type="text"
											id="facility"
											name="facility"
											placeholder="포항고등학교 XX동아리"
											class="input-field"
										/>
									</td>
								</tr>

								<!-- 이용목적 행 -->
								<tr class="input-row">
									<th scope="row" class="label-cell">
										<label for="purpose">이용목적<span class="required">*</span></label>
									</th>
									<td class="content-cell" colspan="3">
										<textarea
											id="purpose"
											name="purpose"
											placeholder="고등학교 동아리 캠프에서 사용하려고 합니다."
											rows="5"
											class="textarea-field"></textarea>
									</td>
								</tr>

								<!-- 첨부양식 행 -->
								<tr class="input-row">
									<th scope="row" class="label-cell">
										<label for="required-files">첨부양식<span class="required">*</span></label>
									</th>
									<td class="content-cell attachment-content" colspan="3">
										<ul class="attachments-list">
											<li class="attachment-item">
												<a href="#" class="attachment-link">
													<img src="../assets/images/icon/file-icon.svg" alt="파일" />
													<span class="file-name">공지사항.hwp</span>
													<span class="file-size">(1.2MB)</span>
												</a>
											</li><li class="attachment-item">
												<a href="#" class="attachment-link">
													<img src="../assets/images/icon/file-icon.svg" alt="파일" />
													<span class="file-name">첨부파일.pdf</span>
													<span class="file-size">(2.5MB)</span>
												</a>
											</li>
										</ul>
									</td>
								</tr>

								<!-- 첨부파일 행 -->
								<tr class="input-row">
									<th scope="row" class="label-cell">
										<label for="additional-files">첨부파일</label>
									</th>
									<td class="content-cell" colspan="3">
										<div class="file-upload-section">
											<!-- 파일 안내 -->
											<div class="file-notice">
												<span class="notice-text" style="color: darkred">
													※ 허용 파일 확장자 :
													.jpg,.jpeg,.gif,.png,.bmp,.txt,.pdf,.xls,.xlsx,.ppt,.pptx,.doc,.docx,.hwp,.zip,.7z,.rar,.alz,.hwx,.hwpx
												</span>
											</div>

											<!-- 파일 업로드 영역 -->
											<div class="file-drop-zone">
												<input
													type="file"
													id="additional-files"
													name="additional-files"
													multiple
													accept=".jpg,.jpeg,.gif,.png,.bmp,.txt,.pdf,.xls,.xlsx,.ppt,.pptx,.doc,.docx,.hwp,.zip,.7z,.rar,.alz,.hwx,.hwpx"
													class="file-input hidden"
												/>
												<label for="additional-files" class="file-drop-label">
													<span class="drop-text">파일을 선택하거나 여기로 드래그하세요.</span>
												</label>
											</div>

											<!-- 파일 정보 표시 -->
											<div class="file-info">
												<span class="file-count">File : 0/5</span>
												<span class="file-size">Total Size : 0 / 100MB</span>
											</div>

											<!-- 첨부된 파일 목록 -->
											<div class="file-list" id="additional-files-list"></div>
										</div>
									</td>
								</tr>
							</tbody>
						</table>

						<button
							type="button"
							class="check-btn"
							style="margin-top: 1.55rem;   margin-bottom: 1.55rem; padding: 20px 12px;"
							>다음</button
						>
					</div>
				</div>
			</section>
		</SubBody>
	</SubLayout>
</BaseLayout>

<script is:inline>
	document.addEventListener("DOMContentLoaded", function () {
		const fileData = {
			"required-files": new DataTransfer(),
			"additional-files": new DataTransfer(),
		};

		// 파일 드롭존 클릭 시 파일 선택 열기
		document.querySelectorAll(".file-drop-zone").forEach((zone) => {
			zone.onclick = function (e) {
				e.preventDefault();
				e.stopPropagation();
				const input = this.querySelector('input[type="file"]');
				if (input) {
					input.click();
				}
			};
		});

		// 라벨 클릭 시 스크롤 방지 (추가 안전장치)
		document.querySelectorAll(".file-drop-label").forEach((label) => {
			label.onclick = function (e) {
				e.preventDefault();
				e.stopPropagation();
				const inputId = this.getAttribute("for");
				const input = document.getElementById(inputId);
				if (input) {
					input.click();
				}
			};
		});

		// 파일 인풋 직접 클릭 시 이벤트 전파 중단
		document.querySelectorAll('input[type="file"]').forEach((input) => {
			input.onclick = function (e) {
				e.stopPropagation();
			};

			input.onchange = function () {
				const files = Array.from(this.files);
				const dt = fileData[this.id];

				// 기존 파일에 새 파일 추가
				files.forEach((file) => dt.items.add(file));
				this.files = dt.files;

				updateFileDisplay(this.id);
			};
		});

		// 파일 표시 업데이트 함수
		function updateFileDisplay(inputId) {
			const input = document.getElementById(inputId);
			const files = Array.from(input.files);
			const listDiv = document.getElementById(inputId + "-list");
			const section = input.closest(".file-upload-section");
			const countSpan = section.querySelector(".file-count");
			const sizeSpan = section.querySelector(".file-size");

			// 파일 개수 및 총 용량 계산
			const totalSize = files.reduce((sum, file) => sum + file.size, 0);
			const totalSizeMB = (totalSize / 1024 / 1024).toFixed(2);

			countSpan.textContent = `File : ${files.length}/5`;
			sizeSpan.textContent = `Total Size : ${totalSizeMB} / 100MB`;

			// 파일 목록 표시
			listDiv.innerHTML = files
				.map(
					(file, index) => `
				<div class="file-item">
					<img src="../img/icon_clip.svg" alt="파일" class="file-icon">
					<span class="file-name">${file.name}</span>
					<span class="file-size">(${(file.size / 1024).toFixed(1)}KB)</span>
					<button type="button" class="file-remove" onclick="removeFile('${inputId}', ${index})">×</button>
				</div>
			`
				)
				.join("");
		}

		// 파일 삭제 함수 (전역으로 등록)
		window.removeFile = function (inputId, index) {
			const input = document.getElementById(inputId);
			const dt = fileData[inputId];

			// DataTransfer에서 파일 제거
			const files = Array.from(input.files);
			fileData[inputId] = new DataTransfer();
			files.forEach((file, i) => {
				if (i !== index) fileData[inputId].items.add(file);
			});

			input.files = fileData[inputId].files;
			updateFileDisplay(inputId);
		};
	});
</script>
